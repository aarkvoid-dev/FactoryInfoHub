{% extends 'base.html' %}
{% load static i18n %}

{% block title %}Test Email | Factory InfoHub{% endblock %}

{% block extra_css %}
<style>
    .test-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 2rem;
    }
    
    .test-card {
        background: white;
        border: 1px solid #e2e8f0;
        border-radius: 12px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .config-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        border-bottom: 1px solid #f1f5f9;
    }
    
    .config-item:last-child {
        border-bottom: none;
    }
    
    .config-label {
        font-weight: 600;
        color: #334155;
    }
    
    .config-value {
        font-family: 'Courier New', monospace;
        font-size: 0.9rem;
        color: #64748B;
        background: #f8fafc;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        border: 1px solid #e2e8f0;
    }
    
    .btn-test {
        background: linear-gradient(135deg, #EB662B 0%, #FF8A50 100%);
        border: none;
        color: white;
        padding: 1rem 2rem;
        font-weight: 700;
        border-radius: 8px;
        transition: transform 0.2s ease;
        text-decoration: none;
        display: inline-block;
    }
    
    .btn-test:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(235, 102, 43, 0.3);
        color: white;
        text-decoration: none;
    }
    
    .status-badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
    }
    
    .status-success {
        background: #dcfce7;
        color: #16a34a;
        border: 1px solid #bbf7d0;
    }
    
    .status-error {
        background: #fee2e2;
        color: #dc2626;
        border: 1px solid #fecaca;
    }
    
    .status-warning {
        background: #fef3c7;
        color: #d97706;
        border: 1px solid #fde68a;
    }
    
    .instructions {
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .instructions h4 {
        margin-top: 0;
        color: #1A2B3E;
    }
    
    .instructions ul {
        margin-bottom: 0;
    }
    
    .instructions li {
        margin-bottom: 0.5rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="test-container">
    <div class="test-card">
        <h2 class="mb-4">Email System Test</h2>
        
        <div class="instructions">
            <h4>ðŸ”§ Email Configuration Status</h4>
            <p>Current email settings and their values:</p>
            <ul>
                <li><strong>Email Backend:</strong> {{ email_backend }}</li>
                <li><strong>Email Host:</strong> {{ email_host }}</li>
                <li><strong>Email Port:</strong> {{ email_port }}</li>
                <li><strong>Use TLS:</strong> {{ email_use_tls }}</li>
                <li><strong>Host User:</strong> {{ email_host_user }}</li>
                <li><strong>Default From Email:</strong> {{ default_from_email }}</li>
            </ul>
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <div class="test-card">
                    <h5>Current User</h5>
                    <p><strong>Email:</strong> {{ user_email }}</p>
                    <p><strong>Status:</strong> 
                        {% if user.is_authenticated %}
                        <span class="status-badge status-success">Authenticated</span>
                        {% else %}
                        <span class="status-badge status-error">Not Authenticated</span>
                        {% endif %}
                    </p>
                </div>
            </div>
            <div class="col-md-6">
                <div class="test-card">
                    <h5>Test Actions</h5>
                    <form method="post">
                        {% csrf_token %}
                        <button type="submit" class="btn-test">
                            <i class="fas fa-envelope me-2"></i> Send Test Email
                        </button>
                    </form>
                    <p class="mt-3 text-muted">This will send a test email to your registered email address to verify the email system is working.</p>
                </div>
            </div>
        </div>
        
        <div class="test-card">
            <h5>ðŸ“‹ Email Configuration Checklist</h5>
            <div class="config-item">
                <span class="config-label">Gmail App Password</span>
                <span class="config-value">Required for Gmail SMTP</span>
            </div>
            <div class="config-item">
                <span class="config-label">2-Factor Authentication</span>
                <span class="config-value">Must be enabled on Gmail</span>
            </div>
            <div class="config-item">
                <span class="config-label">App Password Setup</span>
                <span class="config-value">Generate in Google Account settings</span>
            </div>
            <div class="config-item">
                <span class="config-label">Email Backend</span>
                <span class="config-value">smtp.EmailBackend</span>
            </div>
        </div>
        
        <div class="test-card">
            <h5>ðŸ”§ Troubleshooting</h5>
            <p><strong>If emails are not being sent:</strong></p>
            <ol>
                <li>Check that you have 2-Factor Authentication enabled on your Gmail account</li>
                <li>Generate an App Password in your Google Account settings</li>
                <li>Replace the regular Gmail password with the App Password in settings</li>
                <li>Ensure the email backend is set to SMTP (not console)</li>
                <li>Check the terminal for detailed error messages</li>
            </ol>
            
            <p><strong>For Development:</strong></p>
            <p>To see emails in the console instead of sending them, uncomment the console backend line in settings.py:</p>
            <div class="config-value">EMAIL_BACKEND = 'django.core.mail.backends.console.EmailBackend'</div>
        </div>
    </div>
</div>
{% endblock %}